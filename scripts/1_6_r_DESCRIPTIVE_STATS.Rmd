---
title: "EDH descriptive stats"
author: "Petra Hermankova"
date: "06/08/2020"
output:
  html_document:
    theme: cerulean
    toc: yes
    toc_depth: 3
---

```{r setup, echo=TRUE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE, error=TRUE)
devtools::install_github("mplex/cedhar", subdir="pkg/sdam")
#install.packages("tidyverse")
#install.packages("getPass")
#install.packages("formatR")
install.packages("Hmisc")

library(tidyverse)
library(tidytext)
library(sdam)
library(jsonlite)
library(getPass)
library(formatR)
library(Hmisc)

```

# Loading data

1. Input your sciencedata.dk username - type directly into the RStudio console
```{r, echo = FALSE }
user <- readline("your sciencedata username: ")
```

2. Make the request (you will be asked for password in a new pop-up window)

```{r, echo = FALSE }
resp = request("EDH_cleaned_2020-06-26.json", path="/sharingin/648597@au.dk/SDAM_root/SDAM_data/EDH/", method="GET", cred=c(user, getPass("your sciencedata password: ")))
```


3. Make a list from the request and display the first six records (head)
```{r}
list_json <- jsonlite::fromJSON(resp)
EDH_tibble = as_tibble(list_json)
```

# What is in the dataset? Descriptive stats

## Total number of inscriptions
```{r}
describe(unlist(EDH_tibble$id))
```

```{r}
total<- nrow(EDH_tibble)
total
```

## Total number of inscriptions by language
```{r}
language<- as.data.frame(table(unlist(EDH_tibble$language)))
language<- language %>% 
  mutate(Percentage = Freq/(total/100))
language$Percent_round<- round(language$Percentage, digits = 2)
```

## Date

### How many % inscription has a start date
```{r}
not_before<- as.data.frame(unlist(EDH_tibble$not_before))
nrow(not_before)/(total/100) 


```

### How many % inscription has an end date
```{r}
not_after<- as.data.frame(unlist(EDH_tibble$not_after))
nrow(not_after)/(total/100)
```

### Earliest date
```{r}
describe(as.numeric(not_before$`unlist(EDH_tibble$not_before)`))
```

### Latest date
```{r}
describe(as.numeric(not_after$`unlist(EDH_tibble$not_after)`))
```

### Additional dating information available through the 'commentary'
```{r}
date_info <- EDH_tibble %>% 
  select(id, not_before, not_after, commentary, origdate_text, origdate_attrs, year_of_find)

date_info <- date_info %>% 
  mutate(date_commentary = ifelse(grepl("\\(C\\):", commentary), "Date related commentary", "N/A"))

date_commentary<- date_info %>% 
  filter(date_commentary == "Date related commentary")

nrow(date_commentary)/(total/100)
```

## Location

```{r}
location<- EDH_tibble %>% 
  select(id, coordinates, findspot_ancient, province_label, province_label_clean, province_label_certainty, country, modern_region, findspot_modern, findspot, present_location, edh_geography_uri, commentary)
```

### How many inscriptions have spatial coordinates
```{r}
coordinates <-as.data.frame(unlist(location$coordinates))
nrow(coordinates)/(total/100)
```
### Known ancient findspot
```{r}
describe(unlist(location$findspot_ancient))
```
```{r}
ancient_findspot <- as.data.frame(unlist(location$findspot_ancient))
nrow(ancient_findspot)/(total/100)
```
#### Uncertain ancient findspot (?)
```{r}
ancient_findspot_uncert <- as.data.frame(str_subset(ancient_findspot$`unlist(location$findspot_ancient)`, "\\?"))
nrow(ancient_findspot_uncert)/(total/100)
```
### Information about province

```{r}
nrow(dplyr::filter(location, location$province_label_clean != "unknown"))/(total/100)
```
#### Uncertain Roman province
```{r}
nrow(dplyr::filter(location, location$province_label_certainty == "Uncertain"))/(total/100)
```

#### Unknown province
```{r}
nrow(dplyr::filter(location, location$province_label_clean == "unknown"))/(total/100)
```

### Inscriptions with no spatial information
```{r}
no_coords <- location %>% 
  filter(coordinates == "list()")

# number of inscriptions no coordinates but with ancient findspot known
nrow(as.data.frame(unlist(no_coords$findspot_ancient))) 
nrow(as.data.frame(unlist(no_coords$findspot_ancient)))/(total/100)

# number of inscriptions with no coordinates and ancient findspot unknown
no_coords_no_findspot_anc <- no_coords %>% 
  filter(findspot_ancient == "list()")
nrow(no_coords_no_findspot_anc)
nrow(no_coords_no_findspot_anc)/(total/100)

# number of inscriptions with no coordinates, no ancient nor modern findpot known
no_coords_no_findspot_a_m <- no_coords_no_findspot_anc %>% 
  filter(findspot_modern == "list()")
nrow(no_coords_no_findspot_a_m)
nrow(no_coords_no_findspot_a_m)/(total/100)

unique(no_coords_no_findspot_a_m$present_location)

# number of inscriptions with no coordinates, no ancient nor modern findpot known, nor their present location
no_coords_no_findspot_a_m_no_present<- no_coords_no_findspot_a_m %>% 
  filter(present_location == "list()"| present_location == "lost")
nrow(no_coords_no_findspot_a_m_no_present)
nrow(no_coords_no_findspot_a_m_no_present)/(total/100)

table(no_coords_no_findspot_a_m_no_present$province_label_clean)

# inscriptions with no spatial information, not even province
no_spatial_info<- no_coords_no_findspot_a_m_no_present %>% 
  filter(province_label_clean == "unknown" & country == "unknown")
nrow(no_spatial_info)
nrow(no_spatial_info)/(total/100)

# inscriptions with at least province or modern country spatial information
province_modern_country<- no_coords_no_findspot_a_m_no_present %>% 
  filter(province_label_clean != "unknown" & country != "unknown")
nrow(province_modern_country)
nrow(province_modern_country)/(total/100)

```
#### Inscriptions with 
```{r}

```

